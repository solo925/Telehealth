{% comment %} This code sets up a WebSocket connection to a chat room and
handles sending and receiving messages. The `chatSocket` object is created to
connect to the WebSocket endpoint at the specified URL, which includes the room
name. When a message is received, the code updates the chat log with the
message. The code also sets up event handlers for the chat input field and
submit button, allowing the user to send messages by pressing Enter or clicking
the submit button. The sent messages are then transmitted over the WebSocket
connection. {% endcomment %} {% extends 'base/base.html' %}{% block content %}
<script>
  const chatSocket = new WebSocket(
    "ws://" + window.location.host + "/ws/chat/" + roomName + "/"
  );

  chatSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    document.querySelector("#chat-log").value += data.message + "\n";
  };

  document.querySelector("#chat-message-input").focus();
  document.querySelector("#chat-message-input").onkeyup = function (e) {
    if (e.keyCode === 13) {
      // Enter key
      document.querySelector("#chat-message-submit").click();
    }
  };

  document.querySelector("#chat-message-submit").onclick = function (e) {
    const messageInputDom = document.querySelector("#chat-message-input");
    const message = messageInputDom.value;
    chatSocket.send(
      JSON.stringify({
        message: message,
      })
    );
    messageInputDom.value = "";
  };
</script>
{% endblock content %}
